{% extends "base.html" %} {% block title %}Manage Menus{% endblock %} {% block
content %}
<div class="container py-4">
  <h1 class="display-5 fw-bold mb-4">Manage Menus for Your Restaurants</h1>

  <!-- âœ… Search Bar -->
  <form
    method="get"
    action="{{ url_for('restaurant.manage_menu_all') }}"
    class="mb-4"
  >
    <div class="input-group">
      <input
        type="text"
        name="q"
        class="form-control"
        placeholder="Search menu items..."
        value="{{ q if q else '' }}"
      />
      <button class="btn btn-outline-secondary" type="submit">
        <i class="fas fa-search"></i> Search
      </button>
      {% if q %}
      <a
        href="{{ url_for('restaurant.manage_menu_all') }}"
        class="btn btn-outline-danger"
      >
        <i class="fas fa-times"></i> Clear
      </a>
      {% endif %}
    </div>
  </form>

  {% for entry in all_restaurants_menus %}
  <h3 class="mt-4">{{ entry.restaurant.name }}</h3>
  <a
    href="{{ url_for('restaurant.add_menu_item', restaurant_id=entry.restaurant.id) }}"
    class="btn btn-primary mb-2"
  >
    <i class="fas fa-plus me-2"></i>Add Menu Item
  </a>

  {% if entry.menu_by_category %} {% for category, items in
  entry.menu_by_category.items() %}
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">{{ category }}</h5>
      <span class="badge bg-secondary"
        >{{ items|length }} item{{ 's' if items|length != 1 else '' }}</span
      >
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Image</th>
              <th>Item</th>
              <th>Diet</th>
              <th>Description</th>
              <th>Price</th>
              <th>Prep Time</th>
              <th>Status</th>
              <th>Special Tags</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr>
              <td>
                {% if item.image_url %}
                <img
                  src="{{ url_for('static', filename=item.image_url) }}"
                  alt="{{ item.name }}"
                  class="img-thumbnail menu-image"
                  style="
                    width: 60px;
                    height: 60px;
                    object-fit: cover;
                    cursor: pointer;
                  "
                  data-bs-toggle="modal"
                  data-bs-target="#imageModal"
                  data-image="{{ url_for('static', filename=item.image_url) }}"
                  data-title="{{ item.name }}"
                />
                {% else %}
                <img
                  src="{{ url_for('static', filename='images/menu_placeholder.png') }}"
                  alt="No Image"
                  class="img-thumbnail menu-image"
                  style="
                    width: 60px;
                    height: 60px;
                    object-fit: cover;
                    cursor: pointer;
                  "
                  data-bs-toggle="modal"
                  data-bs-target="#imageModal"
                  data-image="{{ url_for('static', filename='images/menu_placeholder.png') }}"
                  data-title="No Image"
                />
                {% endif %}
              </td>
              <td>{{ item.name }}</td>
              <td>
                {% if item.diet_type == 'veg' %}
                <span class="badge bg-success"
                  ><i class="fas fa-leaf me-1"></i>Veg</span
                >
                {% else %}
                <span class="badge bg-danger"
                  ><i class="fas fa-drumstick-bite me-1"></i>Non-Veg</span
                >
                {% endif %}
              </td>
              <td>
                {{ item.description[:50] }}{% if item.description|length > 50
                %}...{% endif %}
              </td>
              <td>â‚¹{{ "%.2f"|format(item.price) }}</td>
              <td>{{ item.preparation_time }} min</td>
              <td>
                {% if item.is_available %}
                <span class="badge bg-success">Available</span>
                {% else %}
                <span class="badge bg-danger">Unavailable</span>
                {% endif %}
              </td>
              <td>
                {% if item.is_special %}
                <span class="badge badge-special">Today's Special</span>
                {% endif %} {% if item.is_deal_of_day %}
                <span class="badge badge-deal">Deal of Day</span>
                {% endif %} {% if item.mostly_ordered %}
                <span class="badge badge-popular">ðŸ”¥ Mostly Ordered</span>
                {% endif %}
              </td>
              <td>
                <a
                  href="{{ url_for('restaurant.edit_menu_item', restaurant_id=entry.restaurant.id, item_id=item.id) }}"
                  class="btn btn-sm btn-outline-primary"
                  ><i class="fas fa-edit"></i
                ></a>
                <form
                  action="{{ url_for('restaurant.delete_menu_item', restaurant_id=entry.restaurant.id, item_id=item.id) }}"
                  method="POST"
                  style="display: inline"
                >
                  <button
                    type="submit"
                    class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('Are you sure you want to delete this item?');"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endfor %} {% else %}
  <p class="text-muted">No menu items for this restaurant yet.</p>
  {% endif %} {% endfor %}
</div>

<!-- Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body text-center p-0">
        <button
          type="button"
          class="btn-close position-absolute top-0 end-0 m-2"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
        <img id="modalImage" src="" class="img-fluid" alt="" />
      </div>
    </div>
  </div>
</div>

<script>
  // Update modal image dynamically
  var imageModal = document.getElementById("imageModal");
  imageModal.addEventListener("show.bs.modal", function (event) {
    var img = event.relatedTarget;
    var src = img.getAttribute("data-image");
    var modalImg = document.getElementById("modalImage");
    modalImg.src = src;
  });
</script>
{% endblock %}
